"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const path_1 = require("path");
const getPackageAsync_1 = require("../build/getPackageAsync");
const template_dirs_1 = require("./template-dirs");
const updateDeps = (a, b) => Object.keys(a).reduce((o, k) => (Object.assign(Object.assign({}, o), { [k]: b[k] ? b[k] : a[k] })), {});
(async () => {
    const cwd = path_1.resolve(process.cwd());
    const cliPackage = await getPackageAsync_1.default(cwd);
    const deps = Object.assign(Object.assign({}, cliPackage.devDependencies), cliPackage.dependencies);
    const updateTemplate = async (dir) => {
        const pkg = await getPackageAsync_1.default(dir);
        pkg.dependencies = updateDeps(pkg.dependencies, deps);
        pkg.devDependencies = updateDeps(pkg.devDependencies, deps);
        pkg.devDependencies['@equinor/fusion-cli'] = `^${cliPackage.version}`;
        fs_1.writeFileSync(path_1.join(dir, 'package.json'), JSON.stringify(pkg, undefined, 2));
    };
    template_dirs_1.default(path_1.join(cwd, 'src', 'templates')).forEach(updateTemplate);
})();
//# sourceMappingURL=update-template-dependencies.js.map