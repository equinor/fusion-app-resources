parameters:
  azureSubscription: ''
  name: ''
  secretName: ''
  vaultName: ''

steps:
  - template: check-for-expiration.yml
    parameters:
      azureSubscription: ${{ parameters.azureSubscription }}
      vaultName: ${{ parameters.vaultName }}
      name: ${{ parameters.name }}_Check
      secretName: ${{ parameters.secretName }}

  - template: generate-secret.yml
    parameters:
      condition: eq(variables['${{ parameters.name }}_Check.generateNew'], 'true')
      azureSubscription: $(subscriptionServiceCore)
      name: ${{ parameters.name }}_SecretGen
      clientId: $(aadApplicationId)
      secretDescription: 'FRA - $(vaultName) - ${{ parameters.secretName }}'

  - template: update-key-vault.yml
    parameters:
      condition: eq(variables['${{ parameters.name }}_Check.generateNew'], 'true')
      azureSubscription: ${{ parameters.azureSubscription }}
      vaultName: ${{ parameters.vaultName }}
      secretName: ${{ parameters.secretName }}
      secret: $(${{ parameters.name }}_SecretGen.secret)